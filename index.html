<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>LED Counter â€“ Watch & Earn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Digital-7&family=Poppins:wght@600&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;font-family:'Poppins',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}
    .iphone{width:100%;height:100%;background:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .screen{width:93.5%;max-width:437px;aspect-ratio:1/1.86;background:linear-gradient(135deg,#f5f5f5 0%,#e1e1e1 100%);border-radius:36px;border:3px solid #8b0000;box-shadow:0 0 0 6px #8b000030,0 0 15px 4px #8b000050;display:flex;flex-direction:column;position:relative;padding:8px}
    .notch{position:absolute;top:0;left:50%;transform:translateX(-50%);width:120px;height:24px;background:#000;border-radius:0 0 18px 18px;z-index:10}
    .user-photo{width:32px;height:32px;border-radius:50%;object-fit:cover;position:absolute;top:6px;left:6px;z-index:11;border:2px solid #fff}
    .status-bar{height:44px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;color:#000;font-size:13px;font-weight:500}
    .status-bar .time{font-weight:600}.status-bar .icons span{margin-left:4px}
    .led-bar{display:flex;justify-content:space-between;align-items:center;padding:6px 16px 8px;font-size:14px;font-weight:600;color:#000}
    .led-box{background:#111;border-radius:8px;padding:4px 8px;box-shadow:inset 0 0 4px rgba(0,0,0,.6)}
    .led-num{font-family:'Digital-7',monospace;font-size:18px;font-weight:400;color:#00ff41;text-shadow:0 0 2px #00ff41,0 0 4px #00ff41}
    .led-usdt .led-num{color:#ffa500;text-shadow:0 0 2px #ffa500,0 0 4px #ffa500}
    .btn-bar{margin-top:auto;display:flex;justify-content:space-evenly;padding:8px 4px 12px;gap:6px}
    .cartoon-btn{flex:1 1 0;aspect-ratio:1/1;border:none;border-radius:14px;background:#000;color:#fff;font-size:11px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;position:relative;top:0;box-shadow:0 6px 0 #444,0 8px 8px rgba(0,0,0,.25);transition:all .1s ease;user-select:none;text-align:center;line-height:1.1}
    .cartoon-btn:active{top:4px;box-shadow:0 2px 0 #444,0 3px 4px rgba(0,0,0,.25)}
    .badge{position:absolute;top:-6px;right:-6px;background:#8b0000;color:#fff;font-size:11px;border-radius:10px;padding:3px 6px;min-width:18px;text-align:center}

    #refUI{display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:24px;gap:16px}
    #refUI h3{color:#8b0000;font-size:18px}
    #refUI .link-box{background:#111;border-radius:8px;padding:8px 12px;font-size:14px;color:#00ff41;font-family:'Digital-7',monospace;text-shadow:0 0 2px #00ff41;max-width:90%;word-break:break-all}
    #refUI .copy-btn{background:#8b0000;color:#fff;border:none;border-radius:12px;padding:10px 24px;font-weight:600;cursor:pointer;box-shadow:0 4px 0 #600,0 6px 6px rgba(0,0,0,.25)}
    #refUI .copy-btn:active{transform:translateY(2px);box-shadow:0 2px 0 #600,0 3px 4px rgba(0,0,0,.25)}
    #refUI .count{font-size:16px;color:#333}
  </style>
</head>
<body>
<div class="iphone">
  <div class="screen">
    <img id="userPhoto" class="user-photo" style="display:none"/>
    <div class="notch"></div>

    <!-- Main UI -->
    <div id="mainUI" style="width:100%;height:100%;display:flex;flex-direction:column">
      <div class="status-bar">
        <span class="time">9:41</span>
        <span class="icons"><span>ðŸ“¶</span><span>ðŸ”‹</span></span>
      </div>
      <div class="led-bar">
        <span>USDT</span>
        <div class="led-box led-usdt"><span class="led-num" id="usdtVal">0.00</span></div>
        <div class="led-box"><span class="led-num" id="pointsVal">0</span></div>
        <span>Points</span>
      </div>
      <div class="btn-bar">
        <button class="cartoon-btn">Task</button>
        <button class="cartoon-btn">Swap</button>
        <button class="cartoon-btn">Withdraw</button>
        <button class="cartoon-btn" id="watchBtn">
          Watch
          <span class="badge" id="watchBadge">15</span>
        </button>
        <button class="cartoon-btn" id="copyBtn">Copy</button>
      </div>
    </div>

    <!-- Referral UI -->
    <div id="refUI">
      <h3>Share Your Link & Earn!</h3>
      <div class="link-box" id="refLink"></div>
      <button class="copy-btn" id="copyLinkBtn">Copy Link</button>
      <div class="count">Referrals: <b id="refCount">0</b></div>
      <button class="cartoon-btn" style="margin-top:auto;margin-bottom:20px;width:120px" onclick="showMain()">Back</button>
    </div>

  </div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  /* ---------- CONFIG ---------- */
  const BOT_USERNAME = 'YOUR_BOT_USERNAME'; // â† change only here (no @)

  /* ---------- UTILS ---------- */
  const $ = id => document.getElementById(id);
  const mainUI   = $('mainUI');
  const refUI    = $('refUI');
  const refLinkEl= $('refLink');
  const refCountEl=$('refCount');
  const copyBtn  = $('copyBtn');
  const copyLinkBtn=$('copyLinkBtn');

  /* ---------- TELEGRAM CHECK & STORE ---------- */
  window.Telegram.WebApp.ready();
  const initData = window.Telegram.WebApp.initDataUnsafe;

  if(!initData || !initData.user){
    alert('Please open this mini-app through your bot on Telegram.');
    throw new Error('User not authenticated');
  }

  const user = initData.user;
  const userKey = 'tgUser_'+user.id;

  // first visit â†’ save profile
  if(!localStorage.getItem(userKey)){
    const profile = {
      id        : user.id,
      first_name: user.first_name||'',
      last_name : user.last_name ||'',
      username  : user.username  ||'',
      photo_url : user.photo_url ||''
    };
    localStorage.setItem(userKey, JSON.stringify(profile));
  }

  /* ---------- REFERRAL ---------- */
  const refKey = 'refCount_'+user.id;
  let refCount = parseInt(localStorage.getItem(refKey))||0;
  const refLink = `https://t.me/${BOT_USERNAME}/earn?startapp=ref_${user.id}`;

  function showRef(){
    mainUI.style.display='none';
    refUI.style.display='flex';
    refLinkEl.textContent = refLink;
    refCountEl.textContent= refCount;
  }
  function showMain(){
    refUI.style.display='none';
    mainUI.style.display='flex';
  }
  copyBtn.addEventListener('click', showRef);
  copyLinkBtn.addEventListener('click',()=>{
    navigator.clipboard.writeText(refLink).then(()=>{
      copyLinkBtn.textContent='âœ“ Copied!';
      setTimeout(()=>copyLinkBtn.textContent='Copy Link',1500);
    });
  });

  /* ---------- DISPLAY USER PIC / NAME ---------- */
  if(user.photo_url){
    const img=$('userPhoto');
    img.src=user.photo_url;
    img.style.display='block';
  }
  const fullName = [user.first_name,user.last_name].filter(Boolean).join(' ');
  document.title = fullName || 'LED Counter';

  /* ---------- WATCH ADS (POINTS ONLY) ---------- */
  const watchBtn  = $('watchBtn');
  const watchBadge= $('watchBadge');
  const pointsVal = $('pointsVal');
  const usdtVal   = $('usdtVal');

  let counter=15, cooldown=0, points=0;

  function fmtMMSS(s){const m=Math.floor(s/60);return `${m}:${(s%60).toString().padStart(2,'0')}`;}
  function updateWatchBtn(){
    if(cooldown>0){watchBtn.disabled=true; watchBadge.textContent=fmtMMSS(cooldown);}
    else{watchBtn.disabled=false; watchBadge.textContent=counter;}
  }
  watchBtn.addEventListener('click',()=>{
    if(cooldown>0)return;
    if(counter<=0){
      cooldown=60*60;
      updateWatchBtn();
      const iv=setInterval(()=>{
        cooldown--;
        updateWatchBtn();
        if(cooldown<=0){clearInterval(iv); counter=15; updateWatchBtn();}
      },1000);
      return;
    }
    counter--; points+=1000;
    pointsVal.textContent=points.toLocaleString();
    usdtVal.textContent='0.00';           // USDT stays zero
    updateWatchBtn();
  });

  /* ---------- CLOCK ---------- */
  function updateTime(){
    const now=new Date(), h=now.getHours().toString().padStart(2,'0'), m=now.getMinutes().toString().padStart(2,'0');
    document.querySelector('.time').textContent=`${h}:${m}`;
  }
  updateTime(); setInterval(updateTime,1000);
</script>
</body>
</html>
